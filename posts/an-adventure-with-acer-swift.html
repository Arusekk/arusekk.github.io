<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8" />
        <meta name="author" content="Arusekk" />
        <link rel="stylesheet" type="text/css" href="../stylesheet.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>
            Arusekk blog: An adventure with Acer Swift
        </title>
    </head>


    <body>
        <div id="header">
            <a href="../">home</a>
            <a href="../archive.html">archive</a>
            <a href="../about.html">about</a>
            <a href="../contact.html">contact</a>
            <a href="../atom.xml">feed</a>
        </div>
        <div id="content">
            <article>
                <h1>An adventure with Acer Swift</h1>
                
                  <h2>2021-01-19</h2>
                
                <section>
                    <p>Recently my old laptop started losing keyboard keys, and I heard that in 2021 it is time to let go of that good ol’ laptop with loud HDD, CD station, shiny HD-ready LCD, dissolved keys, cracked screws, two jacks, snappy sound, rumbling mic, 640x480 webcam, 4GiB RAM, 2x bithread i5-4200M @ 2.50 GHz, especially that I use unstable Gentoo GNU/Linux distro, which requires an overnight CPU-heavy update (Portage, the Gentoo PM, compiles everything from source by default).</p>
<p>So I bought a new one. I searched online for laptops with the following criteria set:</p>
<ol type="1">
<li>without M$ Windows <a href="https://www.gnu.org/proprietary/malware-microsoft.html">malware</a> preinstalled,</li>
<li>without Intel CPU, for no particular reason.</li>
</ol>
<p>(a linguistic digression):</p>
<p>‘A laptop’ came from ‘a lap-top PC’, just as ‘a desktop’ came from ‘a desk-top PC’, and I am not willing to talk any ultrabook / hyperbook nonsense, though I like ‘netbook’ as an analogy of a networking notepad. See <a href="i-translated-git.html">I translated Git!</a> for how hard it is to translate English nominalization of adjectives which is “business as usual”.</p>
<p>This narrowed down the search results to circa 30 distinct models. In whole Poland (<a href="https://mediamarkt.pl/komputery-i-tablety/laptopy-laptopy-2-w-1./procesor=amd,amd-ryzen-3,amd-ryzen-5,amd-ryzen-7,amd-ryzen-9&amp;system-operacyjny=brak-systemu">see</a> <a href="https://www.neonet.pl/komputery/laptopy/f/18176-rodzaj-procesora:amd-ryzen-5,amd-ryzen-7/8183-system-operacyjny:brak.html">it</a> <a href="https://www.euro.com.pl/laptopy-i-netbooki,rodzaj-procesora_3!amd,system-operacyjny_3!bez-systemu.bhtml">for</a> <a href="https://www.mediaexpert.pl/komputery-i-tablety/laptopy-i-ultrabooki/laptopy/system-operacyjny_chrome-os.brak-dos/procesor_amd-seria-e.amd-seria-a.amd-seria-3000.amd-ryzen-3.amd-ryzen-5.amd-ryzen-7.amd-ryzen-9.amd-ryzen-9-5900hx.amd-ryzen-7-5800h">yourself</a>).</p>
<p>And then I thought that any would do, so I took the cheapest one. It happened to be Acer Swift 3 (SF314-42). It had quite everything I needed: - A dedicated power socket. - A USBC port, a USB2 port, and a USB3 port. - A single jack audio socket. - An HDMI socket. - Light weight, full HD matt/frosted LCD (whatever the english name is). - Sharp webcam, NVMe SSD, Ryzen 5, Radeon.</p>
<p>The hardware drawbacks I saw then: - No RJ45 (LAN / Ethernet or what you call it). - Intel Wi-Fi card (nah, it can’t be that bad).</p>
<p>On the first boot an UEFI shell greeted me. A nice one, though the path separators were awfully backwards.</p>
<p>Then I launched a live headless Gentoo to put everything in place. Or so I wanted to do. Before launching a screen appeared that wanted to know whether I wanted to install any special stuff inside my shiny new UEFI, so I just added the live OS’ bootloader, and it booted gracefully.</p>
<p>I just set up Portage make.conf, timezone and locale, installed GRUB and genkernel, compiled a kernel with some preliminary config and the next step was to reboot. When I seleced gentoo-grub in EFI boot selection, it showed a huge red shield with a white cross on it and a label telling me “Secure Boot trust broken!” or something.</p>
<p>Then I wanted to get it working, so just as the owner’s manual said, I went into BIOS (F2 on the logo), added a Supervisor password, added my bootloader’s hash into EFI trusted set, reset the password to empty in order to remove it (per the manual), and selected “Save &amp; poweroff” or something.</p>
<p>Then I tried to enter the BIOS again, but no luck this time :)</p>
<p>It looked just like it had a</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="cf">while</span> (isPasswordSet &amp;&amp; isPasswordUnset) {}</span></code></pre></div>
<p>somewhere, because the logo (normally present for ~a second) did not go away, and was unresponsive to Ctrl+Alt+Delete.</p>
<p>The good news was that my GRUB just worked. My GNU/Linux did not, I guess the kernel was not configured enough. So I took the universal config from Gentoo liveCD and started to throw things away.</p>
<p>The things that didn’t work OOTB were sound, X server, and touchpad. The touchpad still has a 0.001 chance to break @ boot for no reason.</p>
<p>The X server needed <code>dri</code>+<code>amdgpu</code> drivers enabled (no surprise here), The touchpad needed psmouse and some strange AMD I²C – SODIMM bridge driver (no surprise either, but was hard to find <code>pinctrl_amd</code> in Kconfig), the speakers worked with <code>snd_hda_intel</code> universal HD audio driver, and the mic apparently had a separate integrated soundcard (searching for ALC255 told me that, and it is <code>snd_soc_dmic</code>). The ax200 Wi-Fi 6 card needed <code>iwlmvm</code> with <code>ax200</code> firmware blobs. Yeah, no chance to have 100% FLOSS on it now.</p>
<p>But whatever. The BIOS was still broken.</p>
<p>I tried to boot to UEFI directly from Linux (I intentionally skipped GNU now, since it is a <a href="https://github.com/adoakley/efi-boot-to-fw-ui">thin software</a> from an <a href="https://superuser.com/a/1547985/400626">answer</a> to a <a href="https://superuser.com/questions/519718/linux-on-uefi-how-to-reboot-to-the-uefi-setup-screen-like-windows-8-can">SU question</a>).</p>
<p>I contacted Acer support on the phone, and the wisest thing they told me was to update BIOS, and they sent me a BIOS firmware update. It was a zipped EXE, so I started to look for lightweight live M$ Windows images. And not surprisingly I did not find one. Surprisingly though, I found that you can <a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/download-winpe--windows-pe">easily create one</a>! All you need is another M$ Windows machine. I used my work laptop (shhh! don’t tell anyone) to create a 260 MiB iso image in as few as two obvious commands.</p>
<p>(And I was in physical pain having to deal with this mirrored commandline.)</p>
<p>I copied over only several files from inside the ISO to a USB stick (UEFI FTW over BIOS, no more reformatting your USB every single time!). It booted with no pain. And it launched the executable as well (great job, Insyde Corp!). But the executable told me that my BIOS is already up to date, and that I should go hack myself.</p>
<p>So I hacked that the <code>FH4FR108.exe</code> was a 7-zip SFX, extracted it, and finally saw that there is a file called <code>properties.ini</code>, which has tons of description on how to tamper with the parameters and e.g. disable the version check.</p>
<p>(I lied, I searched online for <code>H2OFFT-Wx64.exe</code> and ended up on <a href="https://superuser.com/questions/1496286/how-to-repair-a-broken-bios-setup-utility">SU again</a>).</p>
<p>And it has worked! Now my shiny new laptop works again, without me having to install malware on it.</p>
                </section>
            </article>
        </div>
    </body>

</html>
